<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Mood tracker</title>
</head>
<body>
    <h1>Welcome to the Mood tracker App</h1>
    <p>Latitude: <span id="latitude"></span>&deg;</p>
    <p>Longitude: <span id="longitude"></span>&deg;</p>
    <label for="mood">What is your mood?</label>
    <input id="mood" value="Pretty happy!" />
    <button id="geolocate">geolocate</button>

    <script>
        document.getElementById('geolocate').addEventListener('click', event => {
        // test if geolocation is available
            if ("geolocation" in navigator) {
                // geolocation is available
                console.log("geolocation available");
                const mood = document.getElementById('mood').value;
                navigator.geolocation.getCurrentPosition(async position => {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
                document.getElementById("latitude").textContent = lat;
                document.getElementById("longitude").textContent = lon;

                const data = {lat,lon,mood};
                const options ={
                        // declare the method fetch() will use
                    method : 'POST',
                    headers: {
                        // use the headers to explicit to the server the format of the post   
                        'Content-Type': 'application/json'},
                        // prepare the data to be sent as a JSON encoded string
                    body: JSON.stringify(data)
                }; 
                // the callback function of getCurrentPosition has been made async
                // so the response from the server will not be handled too early
                // i.e. will only be handled when the fetch() is completed
                const response = await fetch('/api', options);
                const json = await response.json();
                console.log(json);
                });
            } else {
                // geolocation IS NOT available
                console.log("geolocation not available");
            }
        });
    </script>
</body>
</html>